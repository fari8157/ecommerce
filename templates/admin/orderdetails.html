{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Adore Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{% static 'assets/vendors/mdi/css/materialdesignicons.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/css/vendor.bundle.base.css' %}">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="{% static 'assets/vendors/jvectormap/jquery-jvectormap.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/flag-icon-css/css/flag-icon.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.theme.default.min.css' %}">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="{% static 'assets/images/favicon.png' %}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <nav class="sidebar sidebar-offcanvas" id="sidebar">
      <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
        <a class="sidebar-brand brand-logo" href="" style="color: white; text-decoration: none;">ADORE</a>

        <a class="sidebar-brand brand-logo-mini" href="" style="color: white; text-decoration: none;">ADORE</a>
      </div>
      <ul class="nav">
        <li class="nav-item menu-items">
          <a class="nav-link" href="{%url 'admin_dashboard' %}">
            <span class="menu-icon">
              <i class="mdi mdi-speedometer"></i>
            </span>
            <span class="menu-title">Dashboard</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#category-menu" aria-expanded="false"
            aria-controls="category-menu">
            <span class="menu-icon">
              <i class="mdi mdi-laptop"></i>
            </span>
            <span class="menu-title">Category</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="category-menu">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="{%url 'category' %}">Category</a></li>
              <li class="nav-item"> <a class="nav-link" href="{%url 'add_category' %}">Add Category</a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#product-menu" aria-expanded="false"
            aria-controls="product-menu">
            <span class="menu-icon">
              <i class="mdi mdi-laptop"></i>
            </span>
            <span class="menu-title">Products</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="product-menu">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="{%url 'products' %}">Products</a></li>
              <li class="nav-item"> <a class="nav-link" href="{%url 'add_products' %}">Add Products</a></li>
              <li class="nav-item"> <a class="nav-link" href="{% url 'product_offers' %}">Product Offers</a></li>
            </ul>
          </div>
        </li>

        <li class="nav-item menu-items">
          <a class="nav-link" href="{% url 'customers' %}">
            <span class="menu-icon">
              <i class="mdi mdi-playlist-play"></i>
            </span>
            <span class="menu-title">CUSTOMERS</span>
          </a>
        </li>

        <li class="nav-item menu-items">
          <a class="nav-link" href="">
            <span class="menu-icon">
              <i class="mdi mdi-chart-bar"></i>
            </span>
            <span class="menu-title">ORDERS</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="{% url 'product_return_requests' %}">
            <span class="menu-icon">
              <i class="mdi mdi-chart-bar"></i>
            </span>
            <span class="menu-title">Return requests</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#coupon-menu" aria-expanded="false"
            aria-controls="product-menu">
            <span class="menu-icon">
              <i class="mdi mdi-laptop"></i>
            </span>
            <span class="menu-title">Coupons</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="coupon-menu">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="{% url 'coupon' %}">Coupons</a></li>
              <li class="nav-item"> <a class="nav-link" href="{% url 'addcoupon' %}">Add Coupon</a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#banner-menu" aria-expanded="false"
            aria-controls="product-menu">
            <span class="menu-icon">
              <i class="mdi mdi-laptop"></i>
            </span>
            <span class="menu-title">Banners</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="banner-menu">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="">Banners</a></li>
              <li class="nav-item"> <a class="nav-link" href="">Add Banners</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_navbar.html -->
      <nav class="navbar p-0 fixed-top d-flex flex-row">
        <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
          <a class="sidebar-brand brand-logo-mini" href="index.html"
            style="color: white; text-decoration: none;">ADORE</a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-stretch">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-menu"></span>
          </button>

          <ul class="navbar-nav navbar-nav-right">
            <li class="nav-item dropdown">
              <a class="nav-link" id="profileDropdown" href="#" data-toggle="dropdown">
                <div class="navbar-profile">
                  <img class="img-xs rounded-circle" src="{% static 'assets/images/faces/face15.jpg' %}" alt="">
                  {% if user.is_authenticated %}
                  <p class="mb-0 d-none d-sm-block navbar-profile-name">{{request.user.username}}</p>
                  {% endif %}
                  <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                aria-labelledby="profileDropdown">
                <div class="dropdown-divider"></div>
                <div class="dropdown-divider"></div>
             
                <a class="dropdown-item preview-item" href="{% url 'adminlogout' %}">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-logout text-danger"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <a class="preview-subject mb-1" href="">Log out</a>
                  </div>
                </a>

            </li>
          </ul>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
            data-toggle="offcanvas">
            <span class="mdi mdi-format-line-spacing"></span>
          </button>
        </div>
      </nav>
     
         <!-- our content starts here -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div style="overflow-y: auto;" class="w-100 d-flex align-items-center align-items-center">
                <div class="col-lg-12">
                    <div class="card mt-4">
                        <div class="card-header py-4 " style="background-color: aliceblue;">
                            <h4 class="mb-0 text-black">#Order Details</h4>
                            <p class="mb-0 text-black">ORDER_ID_{{ order.id }}</p>
                        </div>
                        <div class="card-body bg-light">
                            <section>
                                <div class="container h-100">
                                    <div class="row d-flex justify-content-between">
                                        <div class="card card-stepper text-black col-lg-4 col-md-6 bg-light" style="border-radius: 16px;">
                                            <div class="card-body pt-5 pl-5  bg-light"  style="border-radius: 16px; background-color: white; color:black">
                                                <span class="flex justify-content-between align-items-center mb-5 text-center">
                                                    <span>
                                                        <h5 class="mb-0 text-center" style="display: inline;">Order Placed By : {{ order.user.name }} </h5><br>
                                                        <h6 class="text-primary" style="display: inline;">
                                                            
                                                        </h6>
                                                    </span><br>
                                                    <p class="mb-0 px-0"
                                                        style="font-size: 15px; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; line-height: 16px; display: inline;">
                                                        Order Placed on {{ order.order_date }}
                                                    </p>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="card card-stepper text-black col-lg-4 col-md-6 ml-auto mt-1 bg-light" style="border-radius: 56px;">
                                            <div class="card-body pt-5 pl-5 bg-light" style="border-radius: 16px;background-color: white; color: black">
                                                <h5 style="display: inline;">Status:</h5>
                                                <a class="btn btn-small rounded-pill py-0 {{ order.order_status }}" id="orderStatus">
                                                   
                                                </a>
                                                <br>
                                                <select class="form-select col-8 mt-2" id="status-select" style="background-color: white ;color:black"{% if order.order_status == 'cancelled' or order.order_status == 'delivered' %}disabled{% endif %}>
                                                    <option value="ordered" {% if order.order_status == 'ordered' %}selected{% endif %}>Ordered</option>
                                                    <option value="cancelled" {% if order.order_status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                                                    <option value="shipped" {% if order.order_status == 'shipped' %}selected{% endif %}>Shipped</option>
                                                    <option value="delivered" {% if order.order_status == 'delivered' %}selected{% endif %}>Delivered</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <div class="card mx-3 bg-light">
                                <div class="card-header bg-light " style="color: black;">
                                    Order details<br><small>Your order items</small>
                                </div>
                                <div class="card-body" style="overflow: auto;">
                                    <table class="table text-center table-primary">
                                        <colgroup>
                                            <col width="100" />
                                            <col />
                                            <col width="1" />
                                            <col />
                                            <col width="100" />
                                            <col />
                                            <col width="1" />
                                            <col />
                                        </colgroup>
                                        <thead class=" text-dark" style="background-color: aliceblue;">
                                            <tr>
                                                <th class="first">Image</th>
                                                <th class="text-center font-weight-500">Product</th>
                                                <th class="text-center font-weight-500">Price</th>
                                                <th class="text-center font-weight-500">Qty</th>
                                                <th class="text-start font-weight-500">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-bordered">
                                          {% for item in order.items.all %}
                                            <!-- Loop through products to create rows -->
                                            <tr class="bg-light">
                                                <td class="product-thumbnail text-start">
                                                    <a href="#"><img src="{{ item.product.image.url }}" alt="..." class="img-fluid" width="60vw"></a>
                                                </td>
                                                <td class="text-center" style="font-size: 1.2vw;">
                                                    <b href="#" class="text-dark">{{ item.product.name }}</b>
                                                </td>
                                                <td class="text-center text-dark" style="font-size: 1vw;">
                                                  {{ item.price }}
                                                </td>
                                                <td class="text-center" style="font-size: 1vw;">
                                                    <span>{{ item.quantity }}</span>
                                                </td>
                                                <td id="totalPrice" class="product-subtotal text-center" style="font-size: 1vw;">
                                                    <span>&#8377;{{ item.subtotal }}</span>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            <!-- End of product rows -->
                                        </tbody>
                                    </table>
                                   
                                </div>
                                <div class="col-12 d-flex justify-content-end mt-2">
                                    <div class="d-flex flex-column w-25">
                                        <kbd class="bg-dark font-weight-bolder d-flex justify-content-between">Coupon: <span>&#8377;
                                          {% if order.coupon %}
                                                    -Rs.{{ order.coupon.discount_price }}
                                                {% else %}
                                                    0.00
                                                {% endif %}
                                        </span></kbd>
                                        <kbd class="bg-dark  font-weight-bolder d-flex justify-content-between mt-2">Shipping Charge: <span>&#8377;+Rs.40</span></kbd>
                                        <kbd class="font-weight-bolder mt-2 d-flex justify-content-between mt-2 bg-dark">Total: <span>&#8377;{{ order.total_price }}</span></kbd>
                                    </div>
                                </div>
                            </div>
                            <div class="card m-3 bg-light text-black">
                                <div class="card-header">
                                    Shipping Address
                                </div>
                                <div class="card-body">
                                  <address>
                                    {{ order.address.fullname }}<br>
                                    {{ order.address.apartment }} {{ order.address.street }}<br>{{ order.address.city}}<br>{{ order.address.district}}<br>
                                    {{ order.address.state}}<br>{{ order.address.country}}<br>{{ order.address.zip_code}}<br>
                                    {{ order.address.phone}}<br>
                                  </address>
                                </div>
                            </div>
                            <div class="card m-3 bg-light text-black">
                                <div class="card-header">
                                    Payment Mode
                                </div>
                                <div class="card-body">
                                  {{ order.payment_method }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            




          </div>
          <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted d-block text-center text-sm-left d-sm-inline-block"></span>
            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> <a href=""
                target="_blank"></a></span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- ----------------- -->

  <!-- plugins:js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.3/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script>
    document.getElementById('status-select').addEventListener('change', function(event) {
        const status = event.target.value;
        let id = '{{ order.id }}';
        console.log(status);
    
        Swal.fire({
            title: 'Are you sure?',
            text: 'Do you want to update the order status to ' + status + '?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, update it!',
            cancelButtonText: 'No, keep it',
            background: '#343a40', // Change background color
            color: '#ffffff', // Change text color
            confirmButtonColor: '#28a745', // Change confirm button color
            cancelButtonColor: '#d33' // Change cancel button color
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: 'POST',
                    url: '{% url "update_order_status" %}',  // Use Django's URL template tag to generate the correct URL
                    data: {
                        id: id,
                        status: status,
                        csrfmiddlewaretoken: '{{ csrf_token }}'  // Include the CSRF token if using Django
                    },
                    success: function(response) {
                        document.getElementById("orderStatus").innerText = response.status;
    
                        // Display a SweetAlert notification
                        Swal.fire({
                            title: 'Success!',
                            text: 'Order status has been updated to ' + status,
                            icon: 'success',
                            confirmButtonText: 'OK',
                            background: '#343a40', // Change background color
                            color: '#ffffff', // Change text color
                            confirmButtonColor: '#28a745' // Change confirm button color
                        }).then(() => {
                            if (status === 'cancelled' || status === 'delivered') {
                                // Disable the select element
                                document.getElementById('status-select').disabled = true;
                            }
                        });
                    },
                    error: function(error) {
                        console.error('Error:', error);
    
                        // Display a SweetAlert notification for error
                        Swal.fire({
                            title: 'Error!',
                            text: error.responseJSON ? error.responseJSON.error : 'Unknown error',
                            icon: 'error',
                            confirmButtonText: 'OK',
                            background: '#343a40', // Change background color
                            color: '#ffffff', // Change text color
                            confirmButtonColor: '#28a745' // Change confirm button color
                        });
                    }
                });
            } else {
                // If the user cancels, reset the select to the previous value
                event.target.value = '{{ order.order_status }}';
            }
        });
    });
    </script>

  <script src="{% static 'assets/vendors/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="{% static 'assets/vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{% static 'assets/vendors/progressbar.js/progressbar.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
  <script src="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.js' %}"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="{% static 'assets/js/off-canvas.js' %}"></script>
  <script src="{% static 'assets/js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'assets/js/misc.js' %}"></script>
  <script src="{% static 'assets/js/settings.js' %}"></script>
  <script src="{% static 'assets/js/todolist.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="{% static 'assets/js/dashboard.js' %}"></script>
  <script src="{% static '../../assets/js/chart.js' %}"></script>
  <!-- End custom js for this page -->




</body>

</html>